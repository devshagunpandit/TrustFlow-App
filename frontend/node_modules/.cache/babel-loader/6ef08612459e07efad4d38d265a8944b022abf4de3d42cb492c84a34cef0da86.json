{"ast":null,"code":"var _jsxFileName = \"/workspaces/TrustFlow-App/frontend/src/contexts/AuthContext.js\",\n  _s = $RefreshSig$(),\n  _s2 = $RefreshSig$();\nimport React, { createContext, useContext, useEffect, useState, useCallback } from 'react';\nimport { supabase, signOut as supabaseSignOut } from '@/lib/supabase';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst AuthContext = /*#__PURE__*/createContext({});\nexport const useAuth = () => {\n  _s();\n  return useContext(AuthContext);\n};\n_s(useAuth, \"gDsCjeeItUuvgOWf1v4qoK9RF6k=\");\nexport const AuthProvider = ({\n  children\n}) => {\n  _s2();\n  const [user, setUser] = useState(null);\n  const [profile, setProfile] = useState(null);\n  const [loading, setLoading] = useState(true);\n\n  // Helper: Fetch Profile from DB\n  const fetchProfile = useCallback(async userId => {\n    if (!userId) return;\n    try {\n      const {\n        data,\n        error\n      } = await supabase.from('profiles').select('*').eq('id', userId).single();\n      if (error && error.code !== 'PGRST116') {\n        console.error('Error fetching profile:', error);\n      }\n      setProfile(data || null);\n    } catch (error) {\n      console.error('Error fetching profile:', error);\n    }\n  }, []);\n  useEffect(() => {\n    let mounted = true;\n    const initAuth = async () => {\n      try {\n        // 1. MANUAL TOKEN PARSING (The Fix)\n        // If we see a hash with access_token, manually set the session\n        if (window.location.hash && window.location.hash.includes('access_token')) {\n          const params = new URLSearchParams(window.location.hash.substring(1));\n          const accessToken = params.get('access_token');\n          const refreshToken = params.get('refresh_token');\n          if (accessToken && refreshToken) {\n            const {\n              data,\n              error\n            } = await supabase.auth.setSession({\n              access_token: accessToken,\n              refresh_token: refreshToken\n            });\n            if (!error && data.session) {\n              console.log(\"Manual session set successfully\");\n              // Clear the ugly hash from the URL\n              window.history.replaceState(null, '', window.location.pathname);\n            }\n          }\n        }\n\n        // 2. Standard Session Check\n        const {\n          data: {\n            session\n          },\n          error\n        } = await supabase.auth.getSession();\n        if (mounted) {\n          const currentUser = (session === null || session === void 0 ? void 0 : session.user) || null;\n          setUser(currentUser);\n          if (currentUser) {\n            fetchProfile(currentUser.id);\n          }\n          setLoading(false);\n        }\n      } catch (error) {\n        console.error('Auth Init Error:', error);\n        if (mounted) setLoading(false);\n      }\n    };\n    initAuth();\n\n    // 3. Listen for changes (Sign In / Sign Out)\n    const {\n      data: {\n        subscription\n      }\n    } = supabase.auth.onAuthStateChange(async (event, session) => {\n      if (!mounted) return;\n      const currentUser = (session === null || session === void 0 ? void 0 : session.user) || null;\n      setUser(currentUser);\n      if (currentUser) {\n        fetchProfile(currentUser.id);\n      } else {\n        setProfile(null);\n      }\n      setLoading(false);\n    });\n    return () => {\n      mounted = false;\n      subscription.unsubscribe();\n    };\n  }, [fetchProfile]);\n\n  // inside your AuthContext.jsx\n\n  const signOut = async () => {\n    try {\n      // 1. Tell Supabase to kill the session on the server\n      await supabase.auth.signOut();\n    } catch (error) {\n      console.error(\"Error signing out:\", error);\n    } finally {\n      // 2. Force clear ALL local storage (Removes the cached Supabase token)\n      localStorage.clear();\n\n      // 3. Clear Session Storage (Just in case)\n      sessionStorage.clear();\n\n      // 4. Manually set user state to null immediately\n      setUser(null);\n      setSession(null);\n\n      // 5. HARD Redirect to login\n      // We use window.location instead of navigate() to force a full page refresh.\n      // This clears any lingering React state in memory.\n      window.location.replace('/login');\n    }\n  };\n  const value = {\n    user,\n    profile,\n    loading,\n    signOut,\n    refreshProfile: useCallback(() => user && fetchProfile(user.id), [user, fetchProfile])\n  };\n  return /*#__PURE__*/_jsxDEV(AuthContext.Provider, {\n    value: value,\n    children: children\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 134,\n    columnNumber: 5\n  }, this);\n};\n_s2(AuthProvider, \"F2hfPd6fGUWmmyiCP0oZFAOmfWk=\");\n_c = AuthProvider;\nvar _c;\n$RefreshReg$(_c, \"AuthProvider\");","map":{"version":3,"names":["React","createContext","useContext","useEffect","useState","useCallback","supabase","signOut","supabaseSignOut","jsxDEV","_jsxDEV","AuthContext","useAuth","_s","AuthProvider","children","_s2","user","setUser","profile","setProfile","loading","setLoading","fetchProfile","userId","data","error","from","select","eq","single","code","console","mounted","initAuth","window","location","hash","includes","params","URLSearchParams","substring","accessToken","get","refreshToken","auth","setSession","access_token","refresh_token","session","log","history","replaceState","pathname","getSession","currentUser","id","subscription","onAuthStateChange","event","unsubscribe","localStorage","clear","sessionStorage","replace","value","refreshProfile","Provider","fileName","_jsxFileName","lineNumber","columnNumber","_c","$RefreshReg$"],"sources":["/workspaces/TrustFlow-App/frontend/src/contexts/AuthContext.js"],"sourcesContent":["import React, { createContext, useContext, useEffect, useState, useCallback } from 'react';\nimport { supabase, signOut as supabaseSignOut } from '@/lib/supabase';\n\nconst AuthContext = createContext({});\n\nexport const useAuth = () => useContext(AuthContext);\n\nexport const AuthProvider = ({ children }) => {\n  const [user, setUser] = useState(null);\n  const [profile, setProfile] = useState(null);\n  const [loading, setLoading] = useState(true);\n\n  // Helper: Fetch Profile from DB\n  const fetchProfile = useCallback(async (userId) => {\n    if (!userId) return;\n    try {\n      const { data, error } = await supabase\n        .from('profiles')\n        .select('*')\n        .eq('id', userId)\n        .single();\n\n      if (error && error.code !== 'PGRST116') {\n        console.error('Error fetching profile:', error);\n      }\n      setProfile(data || null);\n    } catch (error) {\n      console.error('Error fetching profile:', error);\n    }\n  }, []);\n\n  useEffect(() => {\n    let mounted = true;\n\n    const initAuth = async () => {\n      try {\n        // 1. MANUAL TOKEN PARSING (The Fix)\n        // If we see a hash with access_token, manually set the session\n        if (window.location.hash && window.location.hash.includes('access_token')) {\n          const params = new URLSearchParams(window.location.hash.substring(1));\n          const accessToken = params.get('access_token');\n          const refreshToken = params.get('refresh_token');\n\n          if (accessToken && refreshToken) {\n            const { data, error } = await supabase.auth.setSession({\n              access_token: accessToken,\n              refresh_token: refreshToken,\n            });\n            if (!error && data.session) {\n              console.log(\"Manual session set successfully\");\n              // Clear the ugly hash from the URL\n              window.history.replaceState(null, '', window.location.pathname);\n            }\n          }\n        }\n\n        // 2. Standard Session Check\n        const { data: { session }, error } = await supabase.auth.getSession();\n        \n        if (mounted) {\n          const currentUser = session?.user || null;\n          setUser(currentUser);\n          if (currentUser) {\n            fetchProfile(currentUser.id);\n          }\n          setLoading(false);\n        }\n      } catch (error) {\n        console.error('Auth Init Error:', error);\n        if (mounted) setLoading(false);\n      }\n    };\n\n    initAuth();\n\n    // 3. Listen for changes (Sign In / Sign Out)\n    const { data: { subscription } } = supabase.auth.onAuthStateChange(\n      async (event, session) => {\n        if (!mounted) return;\n        \n        const currentUser = session?.user || null;\n        setUser(currentUser);\n        \n        if (currentUser) {\n          fetchProfile(currentUser.id);\n        } else {\n          setProfile(null);\n        }\n        setLoading(false);\n      }\n    );\n\n    return () => {\n      mounted = false;\n      subscription.unsubscribe();\n    };\n  }, [fetchProfile]);\n\n  // inside your AuthContext.jsx\n\n  const signOut = async () => {\n    try {\n      // 1. Tell Supabase to kill the session on the server\n      await supabase.auth.signOut();\n    } catch (error) {\n      console.error(\"Error signing out:\", error);\n    } finally {\n      // 2. Force clear ALL local storage (Removes the cached Supabase token)\n      localStorage.clear();\n      \n      // 3. Clear Session Storage (Just in case)\n      sessionStorage.clear();\n\n      // 4. Manually set user state to null immediately\n      setUser(null);\n      setSession(null);\n\n      // 5. HARD Redirect to login\n      // We use window.location instead of navigate() to force a full page refresh.\n      // This clears any lingering React state in memory.\n      window.location.replace('/login'); \n    }\n  };\n\n  const value = {\n    user,\n    profile,\n    loading,\n    signOut,\n    refreshProfile: useCallback(() => user && fetchProfile(user.id), [user, fetchProfile]),\n  };\n\n  return (\n    <AuthContext.Provider value={value}>\n      {children}\n    </AuthContext.Provider>\n  );\n};"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}